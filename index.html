<!DOCTYPE html>
<html lang="de">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>AI Generator</title>
  <link href="https://maxcdn.bootstrapcdn.com/bootstrap/4.5.2/css/bootstrap.min.css" rel="stylesheet">
  <script src="https://code.jquery.com/jquery-3.5.1.min.js"></script>
  <script src="https://cdn.jsdelivr.net/npm/@popperjs/core@2.9.2/dist/umd/popper.min.js"></script>
  <script src="https://maxcdn.bootstrapcdn.com/bootstrap/4.5.2/js/bootstrap.min.js"></script>
  <script src="https://cdn.jsdelivr.net/npm/marked/marked.min.js"></script>
</head>
<body>
  <div class="container mt-5">
    <h1 class="text-center">AI Generator</h1>
    <h3 class="text-center">Erstelle ein Bild oder Text!</h3>
    <div class="row">
      <div class="col-md-8 offset-md-2">
        <br>
        <div class="form-group">
          <label for="typeSelector">Aufgabe ausw√§hlen</label>
          <select class="form-control" id="typeSelector">
            <option value="text">Text</option>
            <option value="image">Bild</option>
          </select>
        </div>
        <div class="form-group" id="aiSelectorDiv">
          <label for="aiSelector">Modell ausw√§hlen</label>
          <select class="form-control" id="aiSelector">
            <!-- Optionen hier... -->
          </select>
        </div>
        <div class="form-group">
          <label for="prompt">Befehl eingeben</label>
          <input type="text" class="form-control" id="prompt" style="width: 100%;" placeholder="Befehl eingeben">
        </div>
        <div class="alert alert-info" role="alert">
          Diese KI kann Fehler machen. Bitte √ºberpr√ºfen Sie die Ergebnisse sorgf√§ltig.
        </div>
        <button class="btn btn-primary btn-block" id="generateBtn">üéâ Erstellen</button>
        <button class="btn btn-secondary btn-block mt-2" id="downloadBtn">‚¨áÔ∏è Herunterladen</button>
        <!-- Loading Indicator -->
        <div id="loadingIndicator" style="display: none;" class="text-center mt-3">
          <div class="spinner-border text-primary" role="status">
            <span class="sr-only">Lade...</span>
          </div>
          <p>Lade...</p>
        </div>
        <div class="mt-4" id="output"></div>
      </div>
    </div>
  </div>

  <script>
document.addEventListener('DOMContentLoaded', function() {
  const aiSelectorDiv = document.getElementById('aiSelectorDiv');
  
  // Event listener for changes in type selection
  document.getElementById('typeSelector').addEventListener('change', function() {
    const selectedType = this.value;
    if (selectedType === 'text') {
      aiSelectorDiv.style.display = 'block';
      updateAiModels(['@hf/google/gemma-7b-it', '@cf/meta/llama-3-8b-instruct', '@cf/thebloke/discolm-german-7b-v1-awq', '@cf/tinyllama/tinyllama-1.1b-chat-v1.0', '@cf/mistral/mistral-7b-instruct-v0.1', '@hf/nousresearch/hermes-2-pro-mistral-7b', '@hf/thebloke/openhermes-2.5-mistral-7b-awq', 'qwen1.5-14b-chat-awq', '@cf/microsoft/phi-2', 'hf/thebloke/neural-chat-7b-v3-1-awq', '@cf/deepseek-ai/deepseek-math-7b-instruct', '@cf/deepseek-ai/deepseek-math-7b-base', '@hf/thebloke/deepseek-coder-6.7b-base-awq', '@cf/stabilityai/stable-diffusion-xl-base-1.0', '@cf/bytedance/stable-diffusion-xl-lightning', '@cf/lykon/dreamshaper-8-lcm']);
    } else if (selectedType === 'image') {
      aiSelectorDiv.style.display = 'block';
      updateAiModels(['@cf/stabilityai/stable-diffusion-xl-base-1.0', '@cf/bytedance/stable-diffusion-xl-lightning', '@cf/lykon/dreamshaper-8-lcm']);
    } else {
      aiSelectorDiv.style.display = 'none';
    }
  });

  async function updateAiModels(models) {
  const aiSelector = document.getElementById('aiSelector');
  aiSelector.innerHTML = '';

  const typeSelector = document.getElementById('typeSelector');
  const selectedType = typeSelector.value;

  // Filter models based on selectedType
  if (selectedType === 'text') {
    models = models.filter(model => !model.includes('stable-diffusion') && !model.includes('dreamshaper'));
  } else if (selectedType === 'image') {
    models = models.filter(model => model.includes('stable-diffusion') || model.includes('dreamshaper'));
  }

  models.forEach(model => {
    const option = document.createElement('option');
    option.value = model;
    option.textContent = model.split('/').pop(); // Display only the model name
    aiSelector.appendChild(option);
  });
}


  // Initial model update based on default selection
  updateAiModels(['@hf/google/gemma-7b-it', '@cf/meta/llama-3-8b-instruct', '@cf/thebloke/discolm-german-7b-v1-awq', '@cf/tinyllama/tinyllama-1.1b-chat-v1.0', '@cf/mistral/mistral-7b-instruct-v0.1', '@hf/nousresearch/hermes-2-pro-mistral-7b', '@hf/thebloke/openhermes-2.5-mistral-7b-awq', 'qwen1.5-14b-chat-awq', '@cf/microsoft/phi-2', 'hf/thebloke/neural-chat-7b-v3-1-awq', '@cf/deepseek-ai/deepseek-math-7b-instruct', '@cf/deepseek-ai/deepseek-math-7b-base', '@hf/thebloke/deepseek-coder-6.7b-base-awq', '@cf/stabilityai/stable-diffusion-xl-base-1.0', '@cf/bytedance/stable-diffusion-xl-lightning', '@cf/lykon/dreamshaper-8-lcm']);

  document.getElementById('generateBtn').addEventListener('click', async () => {
    const type = document.getElementById('typeSelector').value;
    const prompt = document.getElementById('prompt').value;
    let aiModel = '';

    if (type === 'text' || type === 'image') {
      aiModel = document.getElementById('aiSelector').value;
    }

    // Show loading indicator
    const loadingIndicator = document.getElementById('loadingIndicator');
    loadingIndicator.style.display = 'block';

    try {
      const response = await fetch(`/generate?type=${type}&prompt=${encodeURIComponent(prompt)}&aiModel=${encodeURIComponent(aiModel)}`);

      if (type === 'text') {
        const data = await response.json();
        const formattedResponse = data.map(task => {
          return `<div class="card mb-3">
            <div class="card-body">
              <h5 class="card-title">Prompt:</h5>
              <p>${marked.parse(task.inputs.prompt)}</p>
              <h5 class="card-title">Response:</h5>
              <p>${marked.parse(task.response.response)}</p>
            </div>
          </div>`;
        }).join('');
        document.getElementById('output').insertAdjacentHTML('afterbegin', formattedResponse);
      } else if (type === 'image') {
        const blob = await response.blob();
        const url = URL.createObjectURL(blob);
        document.getElementById('output').insertAdjacentHTML('afterbegin', `<img src="${url}" class="img-fluid" alt="Generated Image">`);
      } else {
        document.getElementById('output').innerText = 'Invalid response';
      }
    } catch (error) {
      console.error('Error generating content:', error);
      document.getElementById('output').innerText = 'Error generating content. Please try again.';
    } finally {
      // Hide loading indicator after request is complete
      loadingIndicator.style.display = 'none';
    }
  });

  document.getElementById('downloadBtn').addEventListener('click', () => {
    const output = document.getElementById('output');
    if (output.children.length === 0) {
      alert('Keine generierten Inhalte zum Herunterladen.');
      return;
    }

    const lastContent = output.children[0];
    let blob, url, a;

    if (lastContent.tagName === 'DIV') {
      // Assuming text content
      const textContent = lastContent.innerText;
      blob = new Blob([textContent], { type: 'text/plain' });
      url = URL.createObjectURL(blob);
      a = document.createElement('a');
      a.href = url;
      a.download = 'generierter_text.txt';
    } else if (lastContent.tagName === 'IMG') {
      // Assuming image content
      const imgSrc = lastContent.src;
      a = document.createElement('a');
      a.href = imgSrc;
      a.download = 'generiertes_bild.png';
    } else {
      alert('Unbekannter Inhaltstyp zum Herunterladen.');
      return;
    }

    document.body.appendChild(a);
    a.click();
    document.body.removeChild(a);
  });
});
  </script>
</body>
</html>
